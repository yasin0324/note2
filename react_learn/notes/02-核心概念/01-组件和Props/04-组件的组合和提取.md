# 组件的组合和提取

#组件 #设计模式

组件组合和提取是 React 应用程序设计的关键概念，它们使我们能够构建可维护、可复用的 UI 系统。

## 组件组合

组件组合是指将多个小型组件组合成更大的组件或应用程序。这是 React 的核心理念之一："组合优于继承"。

### 基本组合

最简单的组合是将组件嵌套在其他组件内部：

```jsx
function Welcome(props) {
    return <h1>你好, {props.name}</h1>;
}

function App() {
    return (
        <div>
            <Welcome name="小明" />
            <Welcome name="小红" />
            <Welcome name="小刚" />
        </div>
    );
}
```

### 组合复杂组件

可以组合更复杂的 UI 结构：

```jsx
function ProfileHeader({ user }) {
    return (
        <div className="profile-header">
            <Avatar user={user} />
            <UserName user={user} />
        </div>
    );
}

function ProfileDetails({ user }) {
    return (
        <div className="profile-details">
            <Bio user={user} />
            <ContactInfo user={user} />
        </div>
    );
}

function UserProfile({ user }) {
    return (
        <div className="user-profile">
            <ProfileHeader user={user} />
            <ProfileDetails user={user} />
        </div>
    );
}
```

### 包含关系

组件可以通过`children` prop 接收未知的子元素，类似于 HTML 标签：

```jsx
function Card({ title, children }) {
    return (
        <div className="card">
            <div className="card-header">{title}</div>
            <div className="card-body">{children}</div>
        </div>
    );
}

// 使用
function App() {
    return (
        <Card title="欢迎">
            <p>这是一个示例卡片组件。</p>
            <button>点击我</button>
        </Card>
    );
}
```

### 特殊的 children

有时我们希望有更具体的插槽，而不仅仅是`children`：

```jsx
function SplitPane({ left, right }) {
    return (
        <div className="split-pane">
            <div className="split-pane-left">{left}</div>
            <div className="split-pane-right">{right}</div>
        </div>
    );
}

function App() {
    return <SplitPane left={<Navigation />} right={<Content />} />;
}
```

## 组件提取

组件提取是指将复杂组件拆分成更小、更简单的组件。

### 提取的原则

提取组件时应考虑：

1. **单一职责原则**：每个组件应只负责一个功能
2. **可复用性**：提取后的组件是否可以在多处复用
3. **复杂度**：当组件过于复杂时应该拆分它

### 提取示例

从一个复杂的评论组件中提取小组件：

```jsx
// 原始复杂组件
function Comment({ author, text, date }) {
    return (
        <div className="comment">
            <div className="user-info">
                <img
                    className="avatar"
                    src={author.avatarUrl}
                    alt={author.name}
                />
                <div className="user-name">{author.name}</div>
            </div>
            <div className="comment-text">{text}</div>
            <div className="comment-date">{formatDate(date)}</div>
        </div>
    );
}

// 提取后的组件
function Avatar({ user }) {
    return <img className="avatar" src={user.avatarUrl} alt={user.name} />;
}

function UserInfo({ user }) {
    return (
        <div className="user-info">
            <Avatar user={user} />
            <div className="user-name">{user.name}</div>
        </div>
    );
}

function Comment({ author, text, date }) {
    return (
        <div className="comment">
            <UserInfo user={author} />
            <div className="comment-text">{text}</div>
            <div className="comment-date">{formatDate(date)}</div>
        </div>
    );
}
```

### 提取的好处

1. **提高可读性**：组件更小，更容易理解
2. **促进复用**：小组件可在多处使用
3. **简化测试**：更容易对小组件进行单元测试
4. **关注点分离**：UI 和业务逻辑更清晰

## 组件设计最佳实践

1. **自上而下或自下而上**：

    - 自上而下：先构建顶层组件，再逐步拆分子组件
    - 自下而上：先构建基础组件，再组合成复杂组件

2. **合理的粒度**：

    - 太大：不便于维护和重用
    - 太小：组件过多，增加管理复杂度

3. **明确组件接口**：

    - 设计清晰的 Props 接口
    - 遵循单向数据流
    - 避免过度传递 Props（Props drilling）

4. **共享状态提升**：

    - 当多个组件需要共享状态时，将状态提升到共同的父组件

5. **组合而非继承**：
    - 优先使用组合而非继承来复用代码
    - 使用高阶组件、Render Props 或 Hooks 实现逻辑复用

## 相关概念

-   [[函数组件]] - 在组合中使用的基本组件类型
-   [[类组件]] - 在组合中使用的另一种组件类型
-   [[状态提升]] - 共享状态的设计模式
-   [[组合vs继承]] - 为何在 React 中推荐组合
-   [[高阶组件(HOC)]] - 一种特殊的组件组合
