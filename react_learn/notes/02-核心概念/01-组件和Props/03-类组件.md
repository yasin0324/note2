# 类组件

#组件 #类组件

类组件是使用 ES6 类语法定义的 React 组件，它继承自`React.Component`类，并必须包含一个`render()`方法来返回 React 元素。

## 类组件定义

```jsx
import React, { Component } from "react";

class Welcome extends Component {
    render() {
        return <h1>你好, {this.props.name}</h1>;
    }
}
```

## 类组件特点

-   **有状态**：可以使用`this.state`维护组件内部状态
-   **生命周期**：提供完整的生命周期钩子方法
-   **实例方法**：可以定义类方法处理逻辑
-   **this 绑定**：需要注意方法中的`this`绑定

## 类组件基本结构

一个典型的类组件包含以下几个部分：

```jsx
import React, { Component } from "react";

class Counter extends Component {
    // 构造函数，用于初始化状态和绑定方法
    constructor(props) {
        super(props);
        this.state = {
            count: 0,
        };
        // 绑定方法的this
        this.handleClick = this.handleClick.bind(this);
    }

    // 实例方法
    handleClick() {
        this.setState({ count: this.state.count + 1 });
    }

    // 必需的render方法，返回组件的UI
    render() {
        return (
            <div>
                <p>你点击了 {this.state.count} 次</p>
                <button onClick={this.handleClick}>点击我</button>
            </div>
        );
    }
}
```

## 类组件中的状态

类组件使用`this.state`对象存储状态，使用`this.setState()`方法更新状态：

```jsx
class Counter extends Component {
    constructor(props) {
        super(props);
        this.state = { count: 0 }; // 初始化状态
    }

    increment = () => {
        // 更新状态
        this.setState({ count: this.state.count + 1 });
    };

    // ❌ 错误的状态更新方式
    wrongUpdate() {
        this.state.count += 1; // 直接修改state不会触发重新渲染
    }

    render() {
        return (
            <div>
                <p>计数: {this.state.count}</p>
                <button onClick={this.increment}>增加</button>
            </div>
        );
    }
}
```

## 类组件中的 Props

Props 在类组件中通过`this.props`访问：

```jsx
class Greeting extends Component {
    render() {
        return <h1>你好, {this.props.name}</h1>;
    }
}

// 使用时传入props
<Greeting name="小明" />;
```

## 默认 Props

可以使用`static defaultProps`或类外部的`.defaultProps`设置默认值：

```jsx
class Greeting extends Component {
    static defaultProps = {
        name: "访客",
    };

    render() {
        return <h1>你好, {this.props.name}</h1>;
    }
}

// 或者在类外部
Greeting.defaultProps = {
    name: "访客",
};
```

## 使用箭头函数避免绑定

ES6 箭头函数自动绑定`this`，可以简化代码：

```jsx
class Counter extends Component {
    state = { count: 0 }; // 类属性语法，无需constructor

    // 箭头函数自动绑定this
    increment = () => {
        this.setState({ count: this.state.count + 1 });
    };

    render() {
        return (
            <div>
                <p>计数: {this.state.count}</p>
                <button onClick={this.increment}>增加</button>
            </div>
        );
    }
}
```

## 生命周期方法

类组件提供多种生命周期方法，可以在组件不同阶段执行代码：

```jsx
class LifecycleDemo extends Component {
    constructor(props) {
        super(props);
        this.state = { data: null };
        console.log("1. 构造函数执行");
    }

    componentDidMount() {
        console.log("3. 组件已挂载");
        // 适合发起网络请求
        fetch("https://api.example.com/data")
            .then((response) => response.json())
            .then((data) => this.setState({ data }));
    }

    componentDidUpdate(prevProps, prevState) {
        console.log("4. 组件已更新");
        // 可以比较props和state的变化
    }

    componentWillUnmount() {
        console.log("5. 组件将卸载");
        // 清理工作，如取消订阅、清除定时器等
    }

    render() {
        console.log("2. 渲染方法执行");
        return <div>生命周期演示</div>;
    }
}
```

## 与函数组件对比

类组件与[[函数组件]]相比：

-   语法更复杂，代码量更多
-   可以使用生命周期方法和 this.state（函数组件需要 Hooks）
-   性能略逊于函数组件
-   难以复用组件逻辑（通常需要高阶组件或 render props）

## 何时使用类组件

随着 React Hooks 的普及，类组件使用场景减少，但在以下情况可能仍需使用：

-   维护旧代码
-   需要使用 Error Boundary（错误边界）
-   某些特定场景下 Hooks 无法满足需求

## 相关概念

-   [[函数组件]] - React 的另一种组件定义方式
-   [[组件生命周期]] - 类组件生命周期方法详解
-   [[使用State]] - 在类组件中管理状态
-   [[高阶组件(HOC)]] - 复用类组件逻辑的模式
