# 渲染过程中遇到js文件如何处理？

---

> JavaScript 的加载、解析与执行会阻塞文档的解析

在构建DOM时，HTML解析器若遇到了JavaScript，会暂停文档的解析，将控制权交给JavaScript引擎，等JavaScript引擎运行完毕，浏览器会再从中断的地方恢复继续解析文档。所以如果想要首屏渲染的快，就不应该在首屏就加载js文件，这也是都建议将script标签放在body标签底部的原因。当然不是说script标签必须放在底部，可以给script标签添加defer或async属性。

# 浏览器本地存储方式及使用场景

---

## Cookie

Cookie是最早被提出来的本地存储方式，在此之前，服务端无法判断网络中的两个请求是否是同一用户发起的，为解决这个问题，Cookie就出现了。Cookie的大小只有4kb，是一种纯文本文件，每次发起HTTP请求都会携带Cookie。

+ cookie一旦创建成功，名称就无法修改
+ cookie是无法跨域名的，也就是说a域名和b域名下的cookie是无法共享的，这样能够阻止非法获取其他网站的cookie
+ 每个域名下cookie数量不能超过20个，每个cookie大小不能超过4kb
+ 存在安全问题，如果cookie被拦截了，就可获得session的所有信息，即使加密也于事无补，无需知道cookie的意义，只要转发就能达到目的
+ cookie在请求一个新的页面的时候都会被发送过去

如果需要域名之间跨域共享cookie，有两种方法：
+ 使用Nginx反向代理
+ 在一个站点登录之后，往其他网站写cookie。服务端的session存储到一个节点，cookie存储sessionid

Cookie使用场景：
+ cookie和session结合使用，将sessionid存入cookie，每次发起请求时都会携带这个sessionid，这样服务端就知道是谁发起的请求，从而响应对应的数据
+ 可以用来统计页面的点击次数

## localStorage

localStorage是HTML5新引入的特性，有的时候我们需要存储的信息较大，cookie不能满足我们的需求，就会需要localStorage

+ 在大小方面，localStorage的大小一般为5MB，可以存储更多的信息
+ localStorage是持久储存，不会随着页面的消失而消失，除非主动清理，不然会永远存在
+ 仅存储在本地，不想cookie那样每次HTTP请求都会被携带
+ localStorage存在浏览器兼容问题，IE8以下版本的浏览器不支持
+ 如果浏览器设置为隐私模式，将无法读取到localStorage
+ localStorage受到同源策略的影响，及端口、协议、主机地址有一个不相同，都不能访问

```js
// localStroage常用API：

// 保存数据到localStorage
localStorage.setItem('key', 'value');

// 从localStorage获取数据
let data = localStorage.getItem('key');

// 从localStorage删除保存的数据
localStorage.removeItem('key');

// 从localStorage删除所有保存的数据
localStorage.clear();

// 获取某个索引的key
localStorage.key(index);
```

localStorage使用场景：
+ 有些网站有换肤的功能，这时候就可以将换肤的信息存储在本地的localStorage中，当需要换肤的时候，直接操作local即可
+ 在网站中的用户浏览信息也会存储在localStorage中，还有网站的一些不常变动的个人信息等也可以存储在本地的localStorage中

## sessionStorage

sessionStorage和localStorage都是在HTML5才提出来的存储方案，sessionStorage主要用于临时保存同一窗口（或标签页）的数据，刷新页面时不会删除，关闭窗口或标签页之后将会删除这些数据

sessionStorage与localStorage对比：
+ sessionStorage与localStorage都在**本地进行数据存储**
+ sessionStorage也有同源策略的限制，但是sessionStorage有一条更加严格的限制，sessionStorage只有在同一浏览器的同一窗口下才能共享
+ localStorage和sessionStorage都不能被爬虫爬取

```js
// sessionStorage常用API：

// 保存数据到sessionStorage
sessionStorage.setItem('key', 'value');

// 从sessionStorage获取数据
let data = sessionStorage.getItem('key');

// 从sessionStorage删除保存的数据
sessionStorage.removeItem('key');

// 从sessionStorage删除所有保存的数据
sessionStorage.clear();

// 获取某个索引的key
sessionStorage.key(index);
```

sessionStorage使用场景：
+ sessionStorage具有时效性，可以用来存储一些网站的游客登录信息，还有临时的浏览记录的信息。当关闭网站之后，这些信息就消除了

# cookie、localStorage、sessionStorage区别

---

浏览器常用的存储技术是cookie、localStorage和sessionStorage
+ cookie：最开始是服务端用于记录用户状态的一种方式，由服务端设置，在客户端存储，然后每次发起同源请求时，发送给服务端。cookie最多能存储4k数据，生产时间由expires属性指定，并且cookie只能被同源的页面访问共享
+ sessionStorage：html5提供的一种浏览器本地存储的方法，它借鉴了服务器端session的概念，代表的是一次会话中保存的数据。它一般能够存储5MB或更大的数据，它在当前窗口关闭之后就失效了，并且sessionStorage只能被**同一窗口**的同源页面所访问共享。
+ localStorage：html5提供的一种浏览器本地存储的方法，一般也能够存储5MB或更大的数据。和sessionStorage不同的是，除非主动删除，否则localStorage不会失效，并且localStorage只能被同源页面所访问共享 

| 特性 | cookie | sessionStorage | localStorage |
| ---- | ------ | -------------- | ------------ |
|存储容量|较小（约4kb）|较大（约5MB）|较大（约5MB）|
|生命周期|可控，即可会话级别也可持久化|会话级别，窗口关闭即失效|持久化，除非手动清除|
|作用范围|可跨路径、跨子域名（根据设置）|单一窗口或标签页|同源的所有页面|
|自动发送到服务器|是|否|否|
|安全性|易受XSS和CSRF攻击，需要额外防护|易受XSS攻击，需要防范|易受XSS攻击，需要防范|
