# http和https的区别

---

## 基本概念

**HTTP**（HyperText Transfer Protocol：超文本传输协议）是一种用于分布式、协作式和超媒体信息系统的应用层协议。简单来说就是一种发布和接收HTML页面的方法，被用于在Web浏览器和网站服务器之间传递信息

HTTP默认工作在TCP协议80端口，用户访问网站`http://`开头的都是标准HTTP服务

HTTP协议以明文方式发送内容，不提供任何方式的数据加密，如果攻击者截取了Web浏览器和网站服务器之间的传输报文，就可以直接读懂其中的信息。因此，HTTP协议不适合传输一些敏感信息，比如：信用卡号、密码等支付信息

**HTTPS**（HyperText Transfer Protocol Secure：超文本传输安全协议）是一种透过计算机网络进行安全通信的传输协议。HTTPS经由HTTP进行通信，但利用SSL/TLS来加密数据包。HTTPS开发的主要目的，是提供对网站服务器的身份认证，保护交换数据的隐私和完整性

HTTPS默认工作在TCP协议443端口。工作流程一般如下：

1. TCP三次同步握手
2. 客户端验证服务器数字证书
3. DH算法协商对称加密算法的密钥、hash算法的密钥
4. SSL安全加密隧道协商完成
5. 网站以加密的方式传输，用协商的对称加密算法和密钥加密，保证数据机密性；用协商的hash算法进行数据完整性保护，保证数据不被篡改

## HTTP和HTTPS的区别

+ HTTP是超文本传输协议，信息是明文传输，存在安全风险的问题
+ HTTPS则解决HTTP不安全的缺陷，在TCP和HTTP网络层之间加入了SSL/TLS安全协议，使得报文能够加密传输
+ HTTP连接建立相对简单，TCP三次握手之后便可进行HTTP的报文传输。而HTTPS在TCP三次握手之后，还需进行SSL/TLS的握手过程，才可进入加密报文传输
+ 两者的默认端口不一样，HTTP默认端口号是80，而HTTPS默认端口号是443
+ HTTPS协议需要向CA（证书权威机构）申请数字证书，来保证服务器的身份是可信的

## HTTPS解决了HTTP的哪些问题

+ HTTP由于是明文传输，所以安全上存在以下三个风险：
  + 窃听风险，比如通信链路上可以获取通信内容，用户号容易没
  + 篡改风险，比如强制植入垃圾广告，视觉污染，用户眼容易瞎
  + 冒充风险，比如冒充淘宝网站，用户钱容易没
+ HTTPS在HTTP与TCP层之间加入了SSL/TLS协议，可以很好地解决上述的风险：
  + 信息加密：交互信息无法被窃取
  + 校验机制：无法篡改通信内容，篡改了就不能正常显示
  + 身份证书：证明淘宝是真的淘宝网

> HTTPS是如何解决上面的三个风险的？
>
> + **混合加密**的方式实现信息的**机密性**，解决了窃听的风险
> + **摘要算法**的方式来实现**完整性**，它能够为数据生成独一无二的‘指纹’，指纹用于校验数据的完整性，解决了篡改的风险
> + 将服务器公钥放入到**数字证书**中，解决了冒充的风险

### 混合加密

通过**混合加密**的方式可以保证信息的**机密性**，解决了窃听的风险

![20-混合加密](C:\Users\锅\Desktop\guo\八股\image\20-混合加密.webp)

HTTPS采用的是**对称加密**和**非对称加密**结合的**混合加密**方式：

+ 在通信建立前采用**非对称加密**的方式交换会话秘钥，后续就不再使用非对称加密
+ 在通信过程中全部使用**对称加密**的会话密钥的方式加密明文数据

采用**混合加密**的方式的原因：

+ **对称加密**只使用一个密钥，运算速度快，密钥必须保密，无法做到安全的密钥交换
+ **非对称加密**使用两个密钥：公钥和私钥，公钥可以任意分发而私钥保密，解决了密钥交换问题但速度慢

### 摘要算法 + 数字签名

为了保证传输的内容不被篡改，我们需要对内容计算出一个**指纹**，然后同内容一起传输给对方

对方收到后，先是对内容也计算出一个**指纹**，然后跟发送方发送的指纹做一个比较，如果**指纹**相同，说明内容没有被篡改，否则就可以判断出内容被篡改了

在计算机里会用**摘要算法（哈希函数）来计算出内容的哈希值**，也就是内容的指纹，这个**哈希值是唯一的，且无法通过哈希值推导出内容**

![摘要算法](C:\Users\锅\Desktop\guo\八股\image\摘要算法.webp)

通过哈希算法可以确保内容不会被篡改，**但是并不能保证*内容+哈希值*不会被中间人替换，因为这里缺少对客户端收到的消息是否来源于服务端的证明**

为了避免这种情况，计算机里会用**非对称加密算法**来解决，共有两个密钥：

+ 一个是公钥，这个是可以公开给所有人的
+ 一个是私钥，这个必须由本人管理，不可泄露

这两个密钥是可以**双向加解密**的，比如可以用公钥加密内容，让后用私钥解密，也可以用私钥加密内容，公钥解密内容

流程的不同，意味着目的也不相同：

+ **公钥加密，私钥解密**，目的是为了**保证内容传输的安全**，因为被公钥加密的内容，其他人是无法解密的，只有持有私钥的人，才能解密出实际的内容
+ **私钥加密，公钥解密**，目的是为了**保证消息不会被冒充**，因为私钥是不可泄露的，如果公钥能正常解密出私钥加密的内容，就能证明这个消息是来源于持有私钥身份的人发送的

因为非对称加密的计算比较耗费性能，一般不会用非对称加密来加密实际的传输内容

所以非对称加密的用途主要在于**通过*私钥加密，公钥解密*的方式，来确认消息的身份**，常说的**数字签名算法**，就是用的这种方式，不过私钥加密内容不是本身，而是**对内容的哈希值加密**

![数字签名](C:\Users\锅\Desktop\guo\八股\image\数字签名.webp)

私钥由服务端保管，然后服务端会向客户端颁发对应的公钥。如果客户端收到的信息，能被公钥解密，就说明该消息是由服务器发送的

### 数字证书

![22-数字证书工作流程](C:\Users\锅\Desktop\guo\八股\image\22-数字证书工作流程.webp)
