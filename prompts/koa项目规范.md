# Koa.js 后端项目规范

## 项目结构

- `/app.js`: 应用程序入口
- `/router/`: 路由定义，处理 API 路径映射
- `/controller/`: 控制器，处理业务逻辑
- `/model/`: 数据模型，数据库交互
- `/prisma/`: 数据库模式和配置
- `/middleware/`: 自定义中间件
- `/utils/`: 工具函数
- `/config/`: 环境配置
- `/test/`: 测试文件

## 编码规范

### 命名规范

- 文件名：小写，单词间使用下划线分隔（例如：`user_service.js`）
- 路由：REST风格，复数表示资源集合（例如：`/api/users`）
- 变量和函数：驼峰命名法（例如：`getUserById`）
- 常量：全大写，单词间使用下划线分隔（例如：`MAX_RETRY_COUNT`）

### 函数规范

- 每个函数只做一件事
- 控制器函数应遵循 `async (ctx) => {}` 格式
- 错误处理使用 try/catch
- 避免嵌套回调，优先使用 async/await

### 路由规范

- 路由定义在 `router/` 目录下
- 路由应当分模块组织（例如：`user.js`, `product.js`）
- 路由前缀统一为 `/api`
- HTTP方法映射：
  - GET：获取资源
  - POST：创建资源
  - PUT：完全更新资源
  - PATCH：部分更新资源
  - DELETE：删除资源

### 控制器规范

- 控制器只处理请求参数和响应格式
- 业务逻辑应抽离到服务层
- 统一响应格式

### 模型规范

- 模型对应数据库表结构
- 避免在模型中包含业务逻辑
- 数据库操作使用 Prisma

### 错误处理规范

- 使用自定义错误类
- 错误信息应当明确、一致
- 所有错误应当记录日志

### 代码提交规范

- 提交信息格式：`<type>(<scope>): <subject>`
- 类型包括：feat, fix, docs, style, refactor, test, chore

## 性能优化

- 使用合适的索引
- 实施数据库连接池
- 避免 N+1 查询问题
- 实现适当的缓存策略
- 异步操作处理并发请求