# 内存管理

---

不管什么样的编程语言，在代码的执行过程中都需要给它分配内存，不同的是，某些编程语言需要我们手动管理内存，某些编程语言可以自动帮助我们管理内存

内存管理的生命周期：

1. 分配申请需要的内存（申请）
2. 使用分配的内存（存放一些东西，比如对象）
3. 不需要使用时，对其进行释放

不同编程语言第一步和第三步的实现会有不同：

+ 手动管理内存：比如C、C++等，需要手动管理内存的申请和释放（malloc和free函数）
+ 自动管理内存：比如Java、JavaScript、Python等，它们会自动帮助我们管理内存

# JavaScript的内存管理

---

+ JavaScript会在定义变量时为我们分配内存
+ js对于不同数据类型的内存分配方式会有不同
  + js对于基本数据类型内存的分配会在执行时，直接在栈空间进行分配
  + js对于复杂数据类型内存的分配会在堆内存中开辟一块空间，并将这块空间的指针返回值变量引用

# JavaScript的垃圾回收

---

因为内存的大小是有限的，所以当一些内存不在需要时，我们需要对其进行释放，以便腾出内存空间

手动内存管理的语言中，我们需要通过一些方式来自己释放掉不在需要的内存，比如free函数

> + 但是这种管理的方式非常**低效**，影响我们编写逻辑代码的效率
> + 并且这种方式对开发者的要求也很高，一不小心就会产生**内存泄露**

大部分现代的编程语言都有自己的垃圾回收（Garbage Collection，简称GC）机制：

+ 对于那些不再使用的对象，我们称之为垃圾，它需要被回收，以释放更多的内存空间
+ 我们的语言运行环境，比如Java的运行环境JVM，JavaScript的运行环境js引擎中都会有垃圾回收器
+ 垃圾回收器我们也简称为GC

> GC是怎么知道哪些对象是不再使用的呢？
>
> + GC算法

# 常见的GC算法

---

## 引用计数

+ 当一个对象有一个引用指向它时，它的引用就+1，当一个对象的引用为0时，这个对象就可以被销毁掉

+ 这个算法有一个弊端是会产生循环引用

  ![PixPin_2025-02-16_11-59-26](C:\Users\锅\Desktop\guo\八股\js学习笔记\image\PixPin_2025-02-16_11-59-26.png)

## 标记清除

+ 这个算法是设置一个根对象（root object），垃圾回收器会定期从根对象开始，找所有从根开始有引用到的对象，对于没有引用到的对象，就认为是不可用的对象
+ 这个算法可以很好地解决循环引用的问题

> JS引擎比较广泛的采用的就是标记清除算法，当然类似于V8引擎为了进行更好的优化，它在算法的实现细节上也会结合一些其他的算法